<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta http-equiv="Content-Type"
 content="text/html; charset=ISO-8859-1">
  <title>How to Run PBS Jobs in PTP</title>
  <link rel="stylesheet" type="text/css" href="help.css">
</head>
<body>
<h1>How to Run PBS Jobs in PTP</h1>
<h2>Introduction</h2>
<p>The PBS Eclipse plug-in, part of the <a
 href="../../org.eclipse.ptp.rm.ibm.pe.help/html/PLUGINS_ROOT/org.eclipse.ptp.help/html/toc.html">Parallel
Tools
Platform</a> (PTP), allows you to launch and monitor applications
on local or remote PBS (Portable Batch System) Distributed Resource
Managers.<br>
</p>
<p>This plugin consists of two parts. The first is the Eclipse PTP
plugin code which is responsible for the PTP views presented to the
user and the user's interaction with those views. The second part is a
resource manager (proxy), which is
responsible for communicating with the PTP PBS plugin code, submitting
the application as a job to the PBS batch system, and reporting
application
status to the PTP PBS plugin.<br>
</p>
<h2>Requirements</h2>
<p>In addition to having Eclipse and PTP installed, you need to have
the following software packages installed.</p>
<ul>
  <li>CDT for Helios, available from the Eclipse download site;</li>
  <li>If you wish to run jobs locally (LINUX), you will need to have
installed a PBS system (<a href="http://www.pbsworks.com/">PBS Pro</a>,
    <a
 href="http://www.clusterresources.com/products/torque-resource-manager.php">PBS
Torque</a>) there. <br>
  </li>
</ul>
<h2>Installation</h2>
<br>
Nothing need be done beyond the normal intallation of the PTP
feature.&nbsp; The PBS plugin features a pre-built executable .jar
(pbs_proxy.jar) containing the proxy, which is then automatically
deployed to the chosen location (local or remote) when the
proxy is launched; there is nothing else to do by way of copying or
compiling/building on the target resource.
<h2>Creating a Resource Manager</h2>
<p>The PBS Resource Manager has no general preferences to be set.&nbsp;
However, when an instance of the manager is created, the user has the
option to pre-define which batch-script template it will use, or to
create a custom template, as will be described below.<br>
</p>
<p>To create a resource manager instance, first open the <span
 style="font-weight: bold;">Parallel Runtime perspective:</span><br>
</p>
<ul>
  <li>From the <span style="font-weight: bold;">Window</span> menu,
select "Open Perspective" &gt;&gt; "Other"; in the dialog box, choose
"Parallel Runtime", then "OK":</li>
</ul>
<br>
<p style="margin-left: 40px;"><img style="width: 692px; height: 532px;"
 alt="Choose Parallel Runtime" src="images/01chooseParallelRuntime.jpg"><br>
<br>
</p>
<ul>
  <li>In the "Resource Managers" view, right- (control-) click for the
"Add Resource Manager" action:</li>
</ul>
<br>
<div style="margin-left: 40px;"><img
 style="width: 1223px; height: 898px;" alt="Add Resource Manager"
 src="images/02addResourceManager.jpg"><br>
<br>
<br>
</div>
<ul>
  <li>You should now see the first of five wizard pages appear in a
dialog; this one allows you to select which type of resource manager to
instantiate:</li>
</ul>
<br>
<div style="margin-left: 40px;"><img
 style="width: 955px; height: 720px;" alt="Select PBS"
 src="images/03selectPBS.jpg"><br>
<br>
</div>
<div style="margin-left: 40px;"><br>
</div>
<ul>
  <li>Choose "PBS", and click "Next".&nbsp; The following page allows
you to set up the PBS provider.&nbsp;&nbsp; The location can be either
local or remote; in the former case, nothing else need be done on this
page.&nbsp; For remote PBS, you will need to configure the connection
to the host/resource.&nbsp; For this case, under "Remote service
provider", select the "Remote Tools" option:</li>
</ul>
<br>
<div style="margin-left: 40px;"><img
 style="width: 959px; height: 737px;" alt="Use Remote Tools"
 src="images/04useRemoteTools.jpg"><br>
<br>
</div>
<div style="margin-left: 40px;"><span style="font-weight: bold;"></span><br>
Next, click the "New" button to bring up the connection dialog<span
 style="font-weight: bold;">:<br>
<br>
<br>
<img style="width: 835px; height: 773px;"
 alt="Configure Remote Connection"
 src="images/05configureRemoteHost.jpg"><br>
</span>
<p>Here you can name the resource, provide its address, and set up the
SSH connection with the user name and password, or choose public key
authentication.<br>
</p>
<p>When you have finished entering the appropriate values, click
"Finish" to return to the wizard page.&nbsp; <span
 style="font-weight: bold;">Also be sure to choose the "SSH port
forwarding"</span> <span style="font-weight: bold;">option</span>.<br>
<br>
</p>
</div>
<ul>
  <li>Click "Next" to bring you to the template configuration
page.&nbsp; Here you can set up which batch template will be used to
configure launches for this resource manager (this can, however, be
changed in the Run Configuration).&nbsp; You can also use this page to
create, modify, or delete templates.</li>
</ul>
<br>
<div style="margin-left: 40px;"><img
 style="width: 946px; height: 723px;" alt="Choose Template"
 src="images/06chooseTemplate.jpg"><br>
<br>
</div>
<div style="margin-left: 40px;">
<p>Two pre-defined templates are provided with the PTP PBS
plugin:&nbsp; the <span style="font-style: italic;">default_template</span>
has only a minimal set of configurable job attributes; the <span
 style="font-style: italic;">full_template</span> provides all of the
standard PBS job attributes, and also allows you to insert additional
commands into the batch script.&nbsp; In this view, the configurable
values of the template are displayed, along with the the tool tip, if
any, that can be seen in the run configuration view by hovering over
the attribute name.<br>
</p>
<p>To create a new template, click the "Edit Template" button.&nbsp;
This pops up a dialog asking you which template to display:<br>
<br>
</p>
<p><img style="width: 770px; height: 662px;" alt="Create New Template"
 src="images/07createNewTemplate.jpg"><br>
<br>
</p>
<p>If you are modifying a pre-existing template, just choose the
template from the drop-down list; to create a new template, choose the
template on which you wish to base the customized one.&nbsp; This now
opens a dialog which allows you to edit and save the changes.<br>
<br>
</p>
<p><img style="width: 1308px; height: 828px;" alt="Edit Template"
 src="images/08editTemplate.jpg"><br>
<br>
</p>
<p>A fuller description of the template contents can be found below ...<br>
</p>
<p>To remove a template, use the "Delete Template" button. <br>
</p>
<p><span style="font-weight: bold;">Note:&nbsp; the two provided
templates can neither be edited nor deleted; attempting to do so will
display an error message.</span><br>
</p>
</div>
<ul>
  <li>Clicking "OK" should persist the changes and add the new template
to the drop-down list (in the current example, <span
 style="font-style: italic;">alr_template</span> was created):<br>
  </li>
</ul>
<div style="margin-left: 40px;"><br>
<img style="width: 736px; height: 621px;" alt="New Template Added"
 src="images/09newTemplateAdded.jpg"><br>
<br>
</div>
<br>
<div style="margin-left: 40px;">The new template is thus available for
use by any PBS resource manager instance.<br>
</div>
<br>
<ul>
  <li>The last two pages of this wizard allow you to name the resource
manager and create its configuration (or add it to an empty
pre-existing one).&nbsp;&nbsp; After you have completed the wizard
configuration and clicked "Finish", the new resource manager should
appear in the Resource Managers view.</li>
</ul>
<br>
<div style="margin-left: 40px;"><img
 style="width: 742px; height: 396px;" alt="New Resource Manager"
 src="images/10newResourceManager.jpg"><br>
<br>
<br>
</div>
We are now ready to deply this resource manager and submit a job to
it.&nbsp; The following section demonstrates how to use the PBS launch
configuration.<br>
<h2 style="text-align: left;">Submitting a Job to PBS<br>
</h2>
<div style="margin-left: 40px;"><br>
</div>
While not strictly necessary, we will first start the PBS resource
manager before proceeding to the creation of a run configuration.&nbsp;
<br>
<br>
<ul>
  <li>Select the PBS resource manager and choose "Start Resource
Manager":<br>
  </li>
</ul>
<br>
<div style="margin-left: 40px;"><img
 style="width: 705px; height: 318px;" alt="Start Resource Manager"
 src="images/11startResourceManager.jpg"><br>
</div>
<br>
<br>
In order to launch a job, you will also have to have defined an
appropriate project, either a C/C++ project using CDT, or a Fortran
project using Photran, and to have compiled an executable for it.<br>
<br>
Next, we will create a configuration for launching jobs to this
manager.&nbsp; The procedure is identical to that for creating any Run
Configuration in Eclipse.<br>
<br>
<ul>
  <li>Either select <span style="font-weight: bold;">Run</span>
&gt;&gt; "Run Configurations ..." using the menu, or click on the small
arrow to the right of the Run icon on the toolbar:</li>
</ul>
<br>
<div style="margin-left: 40px;"><img
 style="width: 773px; height: 582px;" alt="Select Run Configuration"
 src="images/12selectRunConfiguration.jpg"><br>
<br>
</div>
<br>
<ul>
  <li>From the list of configuration types displayed, right- (control-)
click on "Parallel Application", and choose "New".&nbsp; A new
configuration will be added and the tab viewer associated with it
displayed.&nbsp; If only one resource manager is available from the list
in the Resource Managers view, the "Resource" tab will be automatically
configured with it; otherwise, you will need to select a resource
manager from the drop down list at the top of the view.&nbsp; Here, we
have selected the PBS@Local manager, whose template was defined to be
the customized <span style="font-style: italic;">alr_template</span>;
we have also renamed this configuration "PBS_alr":</li>
</ul>
<br>
<div style="margin-left: 40px;"><img
 style="width: 1167px; height: 730px;" alt="Create PBS_alr"
 src="images/13createPBS_alr.jpg"><br>
<br>
</div>
<br>
Note at this point several things:&nbsp; first, the "Apply" button,
which allows you to save changes, is not yet enabled.&nbsp; This is
because there are still "errors" to be fixed before the configuration
is considered valid.&nbsp; These errors are displayed at the top of the
panel proceeded by an error icon.&nbsp; In our case we see displayed
there "[Application]: Application program is not
specified".&nbsp;&nbsp; The <span style="font-weight: bold;">Application</span>
tab is warning us that we need to tell the manager which application it
will run.&nbsp; Clicking on the tab switches to that wizard page, where
you can choose the project (at least one project in the workspace needs
to be defined, as mentioned above) and point the "Application program"
to the executable path (if your proxy is remote, the remote file system
will be accessed by the "Browse" button).&nbsp; In the current release,
you also need to define the debugger (this will be fixed in a
subsequent release).&nbsp; However, even if there is no debugger
available, all you need to do is open the <span
 style="font-weight: bold;">Debugger</span> tab, select the debugger
(usually "SDM") and give it a dummy path (any file will do).&nbsp; You
should now be able to save the configuration by clicking "Apply".<br>
<br>
<h3>The PBS Launch Tab</h3>
<br>
The tab, which allows you to configure the job -- in more specific
terms, generate the script to be given to the PBS batch system via the
proxy -- is generated from the chosen template, and consists of three
sections.&nbsp; The top panel allows you to switch out the current
template for any of the other available ones, and also allows you to
see what the batch script to be given to the proxy will look like, on
the basis of the actual values you have provided.&nbsp; The second
panel allows you to choose among no MPI command and the two standard
ones (mpiexec, mpirun).&nbsp; If the chosen template provides for
arbitary commands to be added to the script, the two "Edit" buttons
will appear; clicking on these brings up a dialog in which you may
enter any arbitrary commands that will be understood by the <span
 style="font-style: italic;">bash</span> shell.&nbsp; The bottom panel
exposes the "#PBS" directives included in this template, and allows you
to provide their values:&nbsp; "spinners" are provided for integer
values, selection boxes for values with a fixed set of choices,
checkboxes for boolean (true/false, yes/no) values, and text boxes for
all the other types.&nbsp;&nbsp; Hovering over the attribute name will
often give you additional information on formatting for that particular
attribute.<br>
<br>
<br>
<img style="width: 1181px; height: 574px;" alt="Launch Tab Details"
 src="images/14launchTabDetails.jpg"><br>
<br>
<br>
<h3>Persistence</h3>
<br>
When you click "Apply", the values you entered are saved to persistent
store; however, there are actually two different mappings to be aware
of in this context.&nbsp; The template values, such as "MPI Command",
bash commands, job attribute values, etc., belong to <span
 style="font-style: italic;">this particular</span> <span
 style="font-style: italic;">Run Configuration</span> (in our example, <span
 style="font-style: italic;">PBS_alr</span>); the choice of template,
however, belongs to the <span style="font-style: italic;">Resource
Manager</span> (in our example, <span style="font-style: italic;">PBS@Local</span>).&nbsp;&nbsp;
To illustrate this, let us suppose we had two different configurations,
<span style="font-style: italic;">PBS_A</span> and <span
 style="font-style: italic;">PBS_B</span>; let us further suppose they
both use the <span style="font-style: italic;">PBS@Local</span>
manager:<br>
<br>
<ul>
  <li><span style="font-style: italic;">PBS_A</span> changes the
template for this resource manager.&nbsp; Inside <span
 style="font-style: italic;">PBS_A</span>, you will now see the tab
rebuilt for that template, but with the values (e.g., <span
 style="font-style: italic;">Account_Name</span>, etc.) that were
originally there.&nbsp; If you switched (after saving these changes) to
    <span style="font-style: italic;">PBS_B</span>, you would now see
its orignal values reappear inside the new template as well.</li>
</ul>
<ul>
  <li>Now let us say that <span style="font-style: italic;">PBS_B</span>
actually swaps out its resource manager for a different (PBS)
one.&nbsp; Again, it will see the original attribute values reappear
inside the template associated with the new resource manager.&nbsp; <span
 style="font-style: italic;">PBS_A, </span>however<span
 style="font-style: italic;">,</span> will remain unaffected.</li>
</ul>
<br>
<br>
<p><a href="toc.html">Back to Table of Contents</a>
</p>
</body>
</html>
